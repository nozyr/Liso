/******************************************************************************* echo_server.c                                                               **                                                                             ** Description: This file contains the C source code for an echo server.  The  **              server runs on a hard-coded port and simply write back anything**              sent to it by connected clients. The code is based on the      **              starter code provided and the I/O multiplex code on 15213      **                                                                             ** Authors: Yurui Zhou <yuruiz@ece.cmu.edu                                     **                                                                             ********************************************************************************/#include "liso.h"#include "conn.h"int main(int argc, char *argv[]){    int listen_sock, client_sock, port;    socklen_t conn_size;    struct sockaddr_in host_addr, cli_addr;    static pool conn_pool;    port = atoi(argv[1]);    fprintf(stdout, "----- Echo Server -----\n");    if ((listen_sock = socket(PF_INET, SOCK_STREAM, 0)) == -1)    {        fprintf(stderr, "Failed creating socket.\n");        return EXIT_FAILURE;    }    host_addr.sin_family = AF_INET;    host_addr.sin_port = htons(port);    host_addr.sin_addr.s_addr = INADDR_ANY;    if (bind(listen_sock, (struct sockaddr *) &host_addr, sizeof(host_addr)))    {        close_socket(listen_sock);        fprintf(stderr, "Failed binding socket.\n");        return EXIT_FAILURE;    }    if (listen(listen_sock, 5))    {        close_socket(listen_sock);        fprintf(stderr, "Error listening on socket.\n");        return EXIT_FAILURE;    }    init_pool(listen_sock, &conn_pool);    do    {        conn_pool.ready_set = conn_pool.read_set;        conn_pool.nconn = select(conn_pool.maxfd + 1, &conn_pool.ready_set, NULL, NULL, NULL);        conn_size = sizeof(cli_addr);        if (FD_ISSET(listen_sock, &conn_pool.ready_set))        {            client_sock = accept(listen_sock, (struct sockaddr *)&cli_addr, &conn_size);            add_conn(client_sock, &conn_pool);        }        conn_handle(&conn_pool);    }while (conn_pool.nconn >= 0);    close_socket(listen_sock);    return EXIT_SUCCESS;}